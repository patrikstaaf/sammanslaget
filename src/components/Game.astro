<section id='game' class='w-full py-6'>
  <div id='unity-container' class='unity-desktop max-w-6xl w-full mx-auto'>
    <canvas
      id='unity-canvas'
      class='max-w-6xl mx-auto w-full rounded-md md:rounded-xl'></canvas>
    <div id='unity-loading-bar'>
      <div id='unity-logo'></div>
      <div id='unity-progress-bar-empty'>
        <div id='unity-progress-bar-full'></div>
      </div>
    </div>
    <div id='unity-warning'></div>
    <div id='unity-footer'>
      <!-- <div id='unity-webgl-logo'></div> -->
      <div id='unity-fullscreen-button' class='hover:scale-110'>
        <svg
          xmlns='http://www.w3.org/2000/svg'
          width='24'
          height='24'
          viewBox='0 0 24 24'
          fill='none'
          stroke='currentColor'
          stroke-width='2'
          stroke-linecap='round'
          stroke-linejoin='round'
          class='feather feather-maximize-2'
          ><polyline points='15 3 21 3 21 9'></polyline><polyline
            points='9 21 3 21 3 15'></polyline><line
            x1='21'
            y1='3'
            x2='14'
            y2='10'></line><line x1='3' y1='21' x2='10' y2='14'></line>
        </svg>
      </div>
      <!-- <div id='unity-build-title'>Bjork&Frihet</div> -->
    </div>
  </div>
  <div class='max-w-6xl w-full mx-auto sm:hidden text-center text-sm pt-10'>
    <p>
      WebGL builds are not supported on mobile devices, however, it still might
      work. If so, please turn your mobile to landscape view in order to
      interact with the game.
    </p>
  </div>
</section>

<script>
  // @ts-nocheck

  var container = document.querySelector('#unity-container');
  var canvas = document.querySelector('#unity-canvas');
  var loadingBar = document.querySelector('#unity-loading-bar');
  var progressBarFull = document.querySelector('#unity-progress-bar-full');
  var fullscreenButton = document.querySelector('#unity-fullscreen-button');
  var warningBanner = document.querySelector('#unity-warning');

  function unityShowBanner(msg, type) {
    function updateBannerVisibility() {
      warningBanner.style.display = warningBanner.children.length
        ? 'block'
        : 'none';
    }
    var div = document.createElement('div');
    div.innerHTML = msg;
    warningBanner.appendChild(div);
    if (type == 'error') div.style = 'background: red; padding: 10px;';
    else {
      if (type == 'warning') div.style = 'background: yellow; padding: 10px;';
      setTimeout(function () {
        warningBanner.removeChild(div);
        updateBannerVisibility();
      }, 5000);
    }
    updateBannerVisibility();
  }

  var buildUrl = 'Build';
  var loaderUrl = buildUrl + '/WebGL Test.loader.js';
  var config = {
    dataUrl: buildUrl + '/WebGL Test.data',
    frameworkUrl: buildUrl + '/WebGL Test.framework.js',
    codeUrl: buildUrl + '/WebGL Test.wasm',
    companyName: 'DefaultCompany',
    productName: 'Bjork_Frihet',
    productVersion: '1.0',
    showBanner: unityShowBanner,
  };

  if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
    var meta = document.createElement('meta');
    meta.name = 'viewport';
    meta.content =
      'width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes';
    document.getElementsByTagName('head')[0].appendChild(meta);
    container.className = 'unity-mobile';
    canvas.className = 'unity-mobile';

    unityShowBanner('WebGL builds are not supported on mobile devices.');
  }

  //   } else {
  //     canvas.style.width = '960px';
  //     canvas.style.height = '600px';
  //   }

  loadingBar.style.display = 'block';

  var script = document.createElement('script');
  script.src = loaderUrl;
  script.onload = () => {
    createUnityInstance(canvas, config, (progress) => {
      progressBarFull.style.width = 100 * progress + '%';
    })
      .then((unityInstance) => {
        loadingBar.style.display = 'none';
        fullscreenButton.onclick = () => {
          unityInstance.SetFullscreen(1);
        };
      })
      .catch((message) => {
        alert(message);
      });
  };
  document.body.appendChild(script);
</script>
